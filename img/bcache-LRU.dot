digraph bcache_LRU {
  // rankdir=LR;
  node [shape=record];

  subgraph cluster_bcache {
    label=<<b>bcache</b>>; style=filled; color=lightgray;
    bcache[label="lock|<b>buf[30]|<h>head|{<p>*prev|<n>*next}"];
  }
  // bcache:b -> cluster_bufs;


  subgraph cluster_bufs {
    label=<<b>buf[30]</b>>; style=filled; color=lightgray;
    buf1[label="<a>buf[0] |dev|blockno|<p>*prev|<n>*next"];
    buf2[label="<a>buf[1] |dev|blockno|<p>*prev|<n>*next"];
    buf3[label="<a>buf[?] |dev|blockno|<p>*prev|<n>*next"];
    buf9[label="<a>buf[29]|dev|blockno|<p>*prev|<n>*next"];
  }

  // {rank=same buf1 buf2 buf9}

  buf1:n -> buf2:n   [color=black];
  buf2:n -> buf3:n   [color=black];
  buf3:n -> buf9:n   [color=black];
  buf9:n -> bcache:h [color=black];

  buf9:p -> buf3:a   [color=blue];
  buf3:p -> buf2:a   [color=blue];
  buf2:p -> buf1:a   [color=blue];
  buf1:p -> bcache:h [color=blue];

  bcache:n -> buf9:se [color=red style=dashed];
  bcache:p -> buf1:ne [color=red style=dashed];
}
