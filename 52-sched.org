#+TITLE: 调度
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2023-11-23 Thu>
#+STARTUP: overview num indent
#+OPTIONS: ^:nil
#+PROPERTY: header-args:sh :results output :dir ../../study/os/xv6-public


* sched() 函数功能
sched() 主要目的是要将进程上下文切换到 mycpu()->scheduler
1. 通常一段程序代码的执行被称为 thread
   - 如果在内核态执行，为 kernel thread
   - 否则在用户态执行，为 user thread
2. sched() 调用的条件是：
   - 进程释放其他持有的锁
   - 持有 ptable.lock
   - 并且修改了 p->state 状态
   - 调用 sched() 来调度进程
3. 传递 intena 位,因为 intena 是 thread 的属性，而非 CPU 的

* 调度流程
1. 获取 ptable.lock, 释放其他锁
   - 这里保持 swtch 时, 进程 p 的 state 和 context 不会被修改
   - 释放其他锁确保在进程切换时不会出现死锁
2. 修改 p->state = RUNNABLE
3. 调用 sched()
