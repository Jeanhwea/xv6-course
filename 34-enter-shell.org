#+TITLE: 从 initcode 到 shell 启动
#+AUTHOR: Jinghui Hu
#+EMAIL: hujinghui@buaa.edu.cn
#+DATE: <2023-11-15 Wed>
#+STARTUP: overview num indent
#+OPTIONS: ^:nil
#+PROPERTY: header-args:sh :results output :dir ../../study/os/xv6-public


* 从 initcode.S 到 init.c
[[file:../../study/os/xv6-public/initcode.S]]

1. 调用 exec 系统调用加载 sh 启动用户 shell
2. 通过系统调用 exec() 执行 /init 文件

* init.c 到 sh.c
[[file:../../study/os/xv6-public/init.c]]

init.c 运行 shell
1. 打开 console 文件
2. 设置 stdout, stderr
3. 循环创建 shell
   - fork 子进程启动 sh
   - 父进程等待
   - 如果子进程退出，则重新拉起 sh

* sh.c 执行，系统启动
调用 sh.c 实现用户 shell
1. 检测 console 文件打开
2. 死循环执行命令
   - 获取命令 getcmd
   - cd 命令的特殊处理
   - fork1 创建子进程
     - 父进程循环
     - 子进程解析命令并运行命令

[[file:../../study/os/xv6-public/sh.c]]
